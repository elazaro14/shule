<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <title>Bulk Upload | Olmoti</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --nav-blue: #1a237e; --sidebar-width: 250px; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; }
        .sidebar { width: var(--sidebar-width); background: var(--nav-blue); color: white; height: 100vh; position: fixed; }
        .main-content { margin-left: var(--sidebar-width); padding: 40px; flex-grow: 1; }
        .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div style="padding:20px; border-bottom:1px solid gold; text-align:center;"><h3>OLMOTI SEC</h3></div>
        <ul style="list-style:none; padding:0;">
            <li><a href="students-list.html" style="color:white; text-decoration:none; display:block; padding:15px;">â¬… Rudi Kwenye Orodha</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="card">
            <h2>Pakia Wanafunzi Wengi (Excel)</h2>
            <p>Safu za Excel ziwe: <strong>Name</strong> na <strong>Class</strong></p>
            <input type="file" id="fUpload" style="margin:20px 0;">
            <br>
            <button id="upBtn" style="padding:15px 30px; background:green; color:white; border:none; cursor:pointer; font-weight:bold;">ANZA KUPAKIA</button>
            <div id="status" style="margin-top:20px; font-weight:bold;"></div>
        </div>
    </div>

    <script type="module">
        import { db } from "./firebase.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        upBtn.onclick = () => {
            const file = fUpload.files[0];
            if(!file) return alert("Chagua file!");
            const reader = new FileReader();
            reader.onload = async (e) => {
                const workbook = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                let count = 0;
                for(let row of rows) {
                    if(row.Name && row.Class) {
                        await addDoc(collection(db, "students"), { name: row.Name, cls: row.Class });
                        count++;
                        status.innerText = `Inapakia... ${count} / ${rows.length}`;
                    }
                }
                status.innerText = "Imekamilika! Wanafunzi " + count + " wameongezwa.";
            };
            reader.readAsArrayBuffer(file);
        };
    </script>
</body>
</html>
