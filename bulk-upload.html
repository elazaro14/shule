<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <title>Bulk Upload | Olmoti</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --nav-blue: #1a237e; --bg: #f4f7f6; --sidebar-width: 260px; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; background: var(--bg); }
        .sidebar { width: var(--sidebar-width); background: var(--nav-blue); color: white; height: 100vh; position: fixed; }
        .main-content { margin-left: var(--sidebar-width); padding: 40px; flex-grow: 1; }
        .upload-card { background: white; padding: 40px; border-radius: 10px; border: 2px dashed #ccc; text-align: center; }
        .btn-upload { background: #2e7d32; color: white; padding: 15px 30px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="sidebar"><div class="sidebar-header"><h2>OLMOTI SEC</h2><small>BULK UPLOAD</small></div></div>
    <div class="main-content">
        <div class="upload-card">
            <h2>Ingiza Wanafunzi kwa Excel</h2>
            <p>Hakikisha Excel yako ina safu mbili: <strong>Name</strong> na <strong>Class</strong></p>
            <input type="file" id="fileInput" accept=".xlsx, .xls">
            <br>
            <button class="btn-upload" id="processBtn">ANZA KUPAKIA (START UPLOAD)</button>
            <div id="status" style="margin-top:20px; font-weight:bold; color:blue;"></div>
        </div>
    </div>

    <script type="module">
        import { db } from "./firebase.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        document.getElementById('processBtn').onclick = () => {
            const file = document.getElementById('fileInput').files[0];
            if(!file) return alert("Chagua file kwanza!");

            const reader = new FileReader();
            reader.onload = async (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

                const status = document.getElementById('status');
                let count = 0;

                for(let row of rows) {
                    // Assuming columns are named "Name" and "Class"
                    if(row.Name && row.Class) {
                        await addDoc(collection(db, "students"), {
                            name: row.Name,
                            cls: row.Class,
                            createdAt: new Date()
                        });
                        count++;
                        status.innerText = `Inapakia: ${count} / ${rows.length}`;
                    }
                }
                status.innerText = `Kazi Imekamilika! Wanafunzi ${count} wameongezwa.`;
                status.style.color = "green";
            };
            reader.readAsArrayBuffer(file);
        };
    </script>
</body>
</html>
