<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Shule ERP</title>
    <style>
        :root {
            --primary: #4e73df; --success: #1cc88a; --info: #36b9cc;
            --male: #4e73df; --female: #f6679a; --bg: #f8f9fc;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        
        .header { margin-bottom: 30px; }
        .header h1 { color: #333; margin: 0; font-size: 28px; }
        .header p { color: #666; margin: 5px 0; }

        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }

        .card {
            background: white; padding: 25px; border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: space-between;
            transition: 0.3s; border-top: 5px solid transparent;
        }
        .card:hover { transform: translateY(-5px); }
        
        .card.students { border-top-color: var(--primary); }
        .card.teachers { border-top-color: var(--success); }
        .card.male { border-top-color: var(--male); }
        .card.female { border-top-color: var(--female); }

        .card-data h4 { margin: 0; color: #888; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; }
        .card-data .count { margin: 8px 0 0; font-size: 32px; font-weight: bold; color: #333; }
        .icon { font-size: 35px; opacity: 0.3; }

        /* Navigation */
        .nav-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .nav-item { 
            background: white; padding: 20px; text-align: center; border-radius: 12px;
            text-decoration: none; color: #333; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.03);
            transition: 0.2s; border: 1px solid #eee;
        }
        .nav-item:hover { background: var(--primary); color: white; border-color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Olmoti Secondary Dashboard</h1>
        <p id="dateDisplay"></p>
    </div>

    <div class="stats-grid">
        <div class="card students">
            <div class="card-data">
                <h4>Total Students</h4>
                <div class="count" id="totalStuds">...</div>
            </div>
            <div class="icon">üìö</div>
        </div>

        <div class="card teachers">
            <div class="card-data">
                <h4>Total Teachers</h4>
                <div class="count" id="totalTeachers">...</div>
            </div>
            <div class="icon">üë®‚Äçüè´</div>
        </div>

        <div class="card male">
            <div class="card-data">
                <h4>Male Students</h4>
                <div class="count" id="maleStuds">...</div>
            </div>
            <div class="icon">üë¶</div>
        </div>

        <div class="card female">
            <div class="card-data">
                <h4>Female Students</h4>
                <div class="count" id="femaleStuds">...</div>
            </div>
            <div class="icon">üëß</div>
        </div>
    </div>

    <h3>Navigation Menu</h3>
    <div class="nav-grid">
        <a href="add-student.html" class="nav-item">Add Students</a>
        <a href="reports.html" class="nav-item">Enter Marks</a>
        <a href="view-report.html" class="nav-item">View Report</a>
        <a href="index.html" class="nav-item" style="color: #e74a3b;">Logout</a>
    </div>
</div>



<script type="module">
    import { db } from "./firebase.js";
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function updateDashboard() {
        try {
            // 1. Fetch Students
            const studentSnap = await getDocs(collection(db, "students"));
            let total = 0;
            let males = 0;
            let females = 0;

            studentSnap.forEach((doc) => {
                const data = doc.data();
                total++;
                // CHECK: Make sure your field in 'Add Student' is exactly "sex" and values are "M" or "F"
                if (data.sex === "M") males++;
                if (data.sex === "F") females++;
            });

            // 2. Fetch Teachers (Counting all records in 'users' collection as a fallback)
            const teacherSnap = await getDocs(collection(db, "users"));
            const teacherCount = teacherSnap.size;

            // 3. Update HTML
            document.getElementById("totalStuds").innerText = total;
            document.getElementById("maleStuds").innerText = males;
            document.getElementById("femaleStuds").innerText = females;
            document.getElementById("totalTeachers").innerText = teacherCount;
            
            document.getElementById("dateDisplay").innerText = new Date().toLocaleDateString('en-GB', {
                day: 'numeric', month: 'long', year: 'numeric'
            });

        } catch (error) {
            console.error("Dashboard Error:", error);
            alert("Database Error: " + error.message);
        }
    }

    updateDashboard();
</script>
</body>
</html>
