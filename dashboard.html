<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Shule ERP</title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary: #4e73df;
            --success: #1cc88a;
            --info: #36b9cc;
            --warning: #f6c23e;
            --danger: #e74a3b;
            --dark: #5a5c69;
            --male: #007bff;
            --female: #e83e8c;
            --bg-body: #f8f9fc;
        }

        body { font-family: 'Nunito', sans-serif; background-color: var(--bg-body); margin: 0; color: var(--dark); }
        .dashboard-wrapper { padding: 25px; max-width: 1200px; margin: auto; }
        
        /* Header Style */
        .welcome-header { margin-bottom: 30px; border-left: 5px solid var(--primary); padding-left: 15px; }
        .welcome-header h1 { margin: 0; font-size: 24px; color: #333; }
        
        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
            gap: 20px; 
            margin-bottom: 40px; 
        }

        /* Modern Card Design */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-bottom: 4px solid transparent;
            transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        
        .stat-info h4 { margin: 0; font-size: 12px; text-transform: uppercase; color: #888; letter-spacing: 1px; }
        .stat-info .number { margin: 5px 0 0; font-size: 28px; font-weight: 800; color: #444; }
        
        /* Specific Colors */
        .card-students { border-bottom-color: var(--primary); }
        .card-teachers { border-bottom-color: var(--success); }
        .card-male { border-bottom-color: var(--male); }
        .card-female { border-bottom-color: var(--female); }

        /* Navigation Menu */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        .menu-item {
            background: white;
            padding: 20px;
            text-align: center;
            text-decoration: none;
            color: var(--dark);
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: 0.3s;
        }
        .menu-item:hover { background: var(--primary); color: white; }

    </style>
</head>
<body>

<div class="dashboard-wrapper">
    <div class="welcome-header">
        <h1>School Dashboard Overview</h1>
        <p id="currentDate"></p>
    </div>

    <div class="stats-grid">
        <div class="stat-card card-students">
            <div class="stat-info">
                <h4>Total Students</h4>
                <div class="number" id="totalStuds">0</div>
            </div>
            <div style="font-size: 30px;">üéì</div>
        </div>

        <div class="stat-card card-teachers">
            <div class="stat-info">
                <h4>Total Teachers</h4>
                <div class="number" id="totalTeachers">0</div>
            </div>
            <div style="font-size: 30px;">üë®‚Äçüè´</div>
        </div>

        <div class="stat-card card-male">
            <div class="stat-info">
                <h4>Male Students</h4>
                <div class="number" id="maleStuds">0</div>
            </div>
            <div style="font-size: 30px; color: var(--male);">‚ôÇ</div>
        </div>

        <div class="stat-card card-female">
            <div class="stat-info">
                <h4>Female Students</h4>
                <div class="number" id="femaleStuds">0</div>
            </div>
            <div style="font-size: 30px; color: var(--female);">‚ôÄ</div>
        </div>
    </div>

    

    <h3 style="margin-bottom: 15px;">Quick Actions</h3>
    <div class="menu-grid">
        <a href="add-student.html" class="menu-item">Student Registry</a>
        <a href="reports.html" class="menu-item">Enter Marks</a>
        <a href="view-report.html" class="menu-item">Generate Reports</a>
        <a href="index.html" class="menu-item" style="color: var(--danger);">Logout</a>
    </div>
</div>

<script type="module">
    import { db } from "./firebase.js";
    import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function loadDashboardData() {
        try {
            // 1. Fetch Students
            const studentSnap = await getDocs(collection(db, "students"));
            const students = studentSnap.docs.map(doc => doc.data());
            
            const total = students.length;
            const males = students.filter(s => s.sex === "M").length;
            const females = students.filter(s => s.sex === "F").length;

            // 2. Fetch Teachers (Assuming teachers are in 'users' collection with role 'teacher')
            const teacherQuery = query(collection(db, "users"), where("role", "==", "teacher"));
            const teacherSnap = await getDocs(teacherQuery);
            const totalTeachers = teacherSnap.size;

            // Update UI
            document.getElementById("totalStuds").innerText = total;
            document.getElementById("maleStuds").innerText = males;
            document.getElementById("femaleStuds").innerText = females;
            document.getElementById("totalTeachers").innerText = totalTeachers;
            
            document.getElementById("currentDate").innerText = new Date().toDateString();

        } catch (error) {
            console.error("Dashboard Load Error:", error);
        }
    }

    loadDashboardData();
</script>
</body>
</html>
