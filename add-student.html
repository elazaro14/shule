<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registry | Shule ERP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav><a href="dashboard.html">â¬… Dashboard</a></nav>
    <div class="dashboard-container">
        <h2>Student Registry</h2>
        <div class="form-section">
            <input id="newName" placeholder="Full Name">
            <select id="newSex"><option value="M">Male</option><option value="F">Female</option></select>
            <select id="newClass">
                <option value="Form 1">Form 1</option><option value="Form 2">Form 2</option>
            </select>
            <button id="addBtn">Add Student</button>
        </div>
        <table border="1" width="100%">
            <thead><tr><th>Name</th><th>Sex</th><th>Class</th><th>Actions</th></tr></thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>

    <script type="module">
        import { db } from "./firebase.js";
        import { collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const col = collection(db, "students");

        async function fetchStudents() {
            const snap = await getDocs(col);
            const tbody = document.getElementById("studentTable");
            tbody.innerHTML = "";
            snap.forEach(d => {
                const s = d.data();
                tbody.innerHTML += `<tr>
                    <td>${s.name}</td><td>${s.sex}</td><td>${s.cls}</td>
                    <td><button onclick="delStud('${d.id}')">Delete</button></td>
                </tr>`;
            });
        }

        window.delStud = async (id) => { if(confirm("Delete?")) { await deleteDoc(doc(db, "students", id)); fetchStudents(); } };

        document.getElementById("addBtn").onclick = async () => {
            const name = document.getElementById("newName").value;
            await addDoc(col, { name, sex: newSex.value, cls: newClass.value });
            fetchStudents();
        };
        fetchStudents();
    </script>
</body>
</html>
