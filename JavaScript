// Simple demo users
const users = {
  admin: { username: "admin", password: "1234" },
  teacher: { username: "teacher", password: "1234" }
};

// Load stored data
let teachers = JSON.parse(localStorage.getItem("teachers")) || [];
let students = JSON.parse(localStorage.getItem("students")) || [];
let marks = JSON.parse(localStorage.getItem("marks")) || [];
let attendance = JSON.parse(localStorage.getItem("attendance")) || [];

// LOGIN
function login(e) {
  e.preventDefault();

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  const role = document.getElementById("role").value;

  if (
    users[role] &&
    users[role].username === username &&
    users[role].password === password
  ) {
    document.getElementById("loginForm").style.display = "none";
    document.getElementById(role + "Panel").style.display = "block";
    loadStudentsToSelect();
    renderLists();
  } else {
    alert("Invalid login details");
  }
}

// ADMIN: ADD TEACHER
function createTeacher(e) {
  e.preventDefault();
  const name = teacherName.value;
  const subject = teacherSubject.value;

  teachers.push({ name, subject });
  localStorage.setItem("teachers", JSON.stringify(teachers));

  teacherName.value = "";
  teacherSubject.value = "";
  renderTeachers();
}

// ADMIN: ADD STUDENT
function createStudent(e) {
  e.preventDefault();
  const name = studentName.value;
  const cls = studentClass.value;

  students.push({ name, cls });
  localStorage.setItem("students", JSON.stringify(students));

  studentName.value = "";
  studentClass.value = "";
  renderStudents();
  loadStudentsToSelect();
}

// TEACHER: ADD MARKS
function addMarks(e) {
  e.preventDefault();
  const student = markStudent.value;
  const score = markScore.value;

  marks.push({ student, score });
  localStorage.setItem("marks", JSON.stringify(marks));

  markScore.value = "";
  renderMarks();
}

// TEACHER: ADD ATTENDANCE
function addAttendance(e) {
  e.preventDefault();
  const student = attStudent.value;
  const status = attStatus.value;

  attendance.push({ student, status, date: new Date().toLocaleDateString() });
  localStorage.setItem("attendance", JSON.stringify(attendance));

  renderAttendance();
}

// RENDER FUNCTIONS
function renderTeachers() {
  teacherList.innerHTML = "";
  teachers.forEach(t =>
    teacherList.innerHTML += `<li>${t.name} â€“ ${t.subject}</li>`
  );
}

function renderStudents() {
  studentList.innerHTML = "";
  students.forEach(s =>
    studentList.innerHTML += `<li>${s.name} (${s.cls})</li>`
  );
}

function renderMarks() {
  marksList.innerHTML = "";
  marks.forEach(m =>
    marksList.innerHTML += `<li>${m.student}: ${m.score}</li>`
  );
}

function renderAttendance() {
  attendanceList.innerHTML = "";
  attendance.forEach(a =>
    attendanceList.innerHTML += `<li>${a.student}: ${a.status} (${a.date})</li>`
  );
}

function loadStudentsToSelect() {
  markStudent.innerHTML = `<option value="">Select Student</option>`;
  attStudent.innerHTML = `<option value="">Select Student</option>`;

  students.forEach(s => {
    markStudent.innerHTML += `<option>${s.name}</option>`;
    attStudent.innerHTML += `<option>${s.name}</option>`;
  });
}

function renderLists() {
  renderTeachers();
  renderStudents();
  renderMarks();
  renderAttendance();
}
