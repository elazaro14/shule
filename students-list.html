<script type="module">
    import { db, auth } from "./firebase.js";
    import { collection, getDocs, doc, query, orderBy, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ... (Your existing Gatekeeper/Role logic here) ...

    async function loadStuds() {
        const tbody = document.getElementById('sTable');
        try {
            const snap = await getDocs(query(collection(db, "students"), orderBy("name")));
            tbody.innerHTML = "";
            let i = 1;
            
            snap.forEach(d => {
                const s = d.data();
                tbody.innerHTML += `
                    <tr>
                        <td>${i++}</td>
                        <td><b>${s.name}</b></td>
                        <td>${s.sex}</td>
                        <td>${s.cls}</td>
                        <td>${s.stream}</td>
                        <td style="text-align:center;">
                            <a href="view-report.html?id=${d.id}" target="_blank" style="text-decoration:none;">
                                <button style="background:#2e7d32; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:bold; display:inline-flex; align-items:center; gap:5px;">
                                    <i class="fas fa-eye"></i> View Report
                                </button>
                            </a>

                            <button onclick="delStud('${d.id}')" style="color:#d32f2f; border:none; background:none; cursor:pointer; margin-left:15px; font-size:1.1rem;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        } catch (error) {
            console.error("Error loading students:", error);
        }
    }

    // ... (Your existing add/delete functions) ...
</script>
